# ===============================
# Train a simple model on Heart Disease Dataset
# and save as models/final_model.pkl
# ===============================

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.pipeline import Pipeline
import joblib
from pathlib import Path

# ---------------------------
# 1. Load Dataset
# ---------------------------
# تأكدي أن ملف dataset اسمه heart_disease.csv في فولدر data
data_path = Path("data/heart_disease.csv")
if not data_path.exists():
    raise FileNotFoundError("Please put heart_disease.csv in data/")

df = pd.read_csv(data_path)

# ---------------------------
# 2. Features & Target
# ---------------------------
features = ['age','sex','cp','trestbps','chol','fbs','restecg','thalach',
            'exang','oldpeak','slope','ca','thal']

# لو dataset عندك فيها عمود target اسمه 'target' (كما في dataset الأصلي)
target = 'target'

X = df[features]
y = df[target]

# ---------------------------
# 3. Train-Test Split
# ---------------------------
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# ---------------------------
# 4. Pipeline (Scaler + Logistic Regression)
# ---------------------------
pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('clf', LogisticRegression(max_iter=1000))
])

# ---------------------------
# 5. Train
# ---------------------------
pipeline.fit(X_train, y_train)

# ---------------------------
# 6. Save Model
# ---------------------------
Path("models").mkdir(exist_ok=True)
joblib.dump(pipeline, "models/final_model.pkl")

print("✅ Model trained and saved to models/final_model.pkl")
